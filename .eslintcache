[{"C:\\xiao\\work\\react\\experience-station\\src\\index.js":"1","C:\\xiao\\work\\react\\experience-station\\src\\reportWebVitals.js":"2","C:\\xiao\\work\\react\\experience-station\\src\\App.js":"3","C:\\xiao\\work\\react\\experience-station\\src\\ConfirmModal.js":"4","C:\\xiao\\work\\react\\experience-station\\src\\service.js":"5","C:\\xiao\\work\\react\\experience-station\\src\\util.js":"6"},{"size":517,"mtime":1609774740983,"results":"7","hashOfConfig":"8"},{"size":375,"mtime":1609774740985,"results":"9","hashOfConfig":"8"},{"size":7204,"mtime":1609946292614,"results":"10","hashOfConfig":"8"},{"size":720,"mtime":1609774740967,"results":"11","hashOfConfig":"8"},{"size":291,"mtime":1609944489723,"results":"12","hashOfConfig":"8"},{"size":1778,"mtime":1609944489726,"results":"13","hashOfConfig":"8"},{"filePath":"14","messages":"15","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"rxtbgd",{"filePath":"17","messages":"18","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"19","messages":"20","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"21","usedDeprecatedRules":"16"},{"filePath":"22","messages":"23","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"24","usedDeprecatedRules":"16"},{"filePath":"25","messages":"26","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"C:\\xiao\\work\\react\\experience-station\\src\\index.js",[],["29","30"],"C:\\xiao\\work\\react\\experience-station\\src\\reportWebVitals.js",[],"C:\\xiao\\work\\react\\experience-station\\src\\App.js",["31","32"],"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"antd-mobile\";\r\nimport QRCode from \"qrcode.react\";\r\nimport ConfirmModal from \"./ConfirmModal\";\r\nimport starIcon from \"./assets/star.png\";\r\nimport nostarIcon from \"./assets/nostar.png\";\r\nimport logo from \"./assets/logo.png\";\r\nimport { getModuleList, getQueryVariable, unique } from \"./util\";\r\nimport { getUseInfo, getSignature } from \"./service\";\r\nimport \"./App.css\";\r\n\r\n// https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx6ac3baea53cef467&redirect_uri=https%3a%2f%2fcoding-pages-bucket-3413143-8194751-9772-444098-1301636502.cos-website.ap-guangzhou.myqcloud.com%2f%3fmoduleKey%3d01%26station%3dsxs&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect\r\n\r\nfunction App() {\r\n  const code = getQueryVariable(\"code\");\r\n  const station = getQueryVariable(\"station\");\r\n  const currentKey = getQueryVariable(\"moduleKey\");\r\n  const [visible, setVisible] = useState(false);\r\n  const [grade, setGrade] = useState(localStorage.getItem(\"grade\"));\r\n  const [nickname, setNickname] = useState(\r\n    localStorage.getItem(\"nickname\") || \"\"\r\n  );\r\n\r\n  const [experiencedModules, setExperiencedModules] = useState(\r\n    JSON.parse(localStorage.getItem(\"experiencedModules\")) || []\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!nickname) {\r\n      getUseInfo(code).then((res) => {\r\n        if (res.resultData) {\r\n          setNickname(res.resultData.nickname);\r\n          localStorage.setItem(\"nickname\", res.resultData.nickname);\r\n        }\r\n      });\r\n    }\r\n  }, [code]);\r\n\r\n  useEffect(() => {\r\n    getSignature(encodeURIComponent(window.location.href.split(\"#\")[0])).then(\r\n      (res) => {\r\n        if (res.resultStatus) {\r\n          const { appId, timestamp, nonceStr, signature } = res.resultData;\r\n          window.wx.config({\r\n            //debug: true,\r\n            appId: appId,\r\n            timestamp: timestamp.toString(), // 必填，生成签名的时间戳\r\n            nonceStr: nonceStr, // 必填，生成签名的随机串\r\n            signature: signature, // 必填，签名\r\n            jsApiList: [\"scanQRCode\"],\r\n          });\r\n        }\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (currentKey) updateModules(currentKey);\r\n  }, []);\r\n\r\n  const updateModules = (k) => {\r\n    const _experiencedModules = unique([...experiencedModules, k]);\r\n    localStorage.setItem(\r\n      \"experiencedModules\",\r\n      JSON.stringify(_experiencedModules)\r\n    );\r\n    setExperiencedModules(_experiencedModules);\r\n  };\r\n\r\n  const handleOk = () => {\r\n    let res = \"\";\r\n    if (experiencedModules.length > 10) {\r\n      res = \"优秀\";\r\n    } else if (experiencedModules.length > 8) {\r\n      res = \"良好\";\r\n    } else if (experiencedModules.length > 6) {\r\n      res = \"及格\";\r\n    } else {\r\n      res = \"不及格\";\r\n    }\r\n    setGrade(res);\r\n    localStorage.setItem(\"grade\", res);\r\n    setVisible(false);\r\n  };\r\n\r\n  const moduleList = getModuleList(station);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <div className=\"App-footer\">东莞城市服务驿站</div>\r\n\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <div className=\"App-title\">\r\n          东莞市公安局\r\n          <br />\r\n          厚街分局\r\n        </div>\r\n        <div className=\"App-slogan\">\r\n          {station ? \"神仙水公园警务工作站\" : \"体育路警务工作站\"} <br />\r\n          欢迎您，{nickname}\r\n        </div>\r\n        <div className=\"App-tip\">注：点亮展项卡片，积分拿礼品</div>\r\n      </header>\r\n\r\n      <div className=\"content\">\r\n        {grade ? (\r\n          <>\r\n            <div className=\"qrcode-container\">\r\n              <div className=\"qrcode-tip\">\r\n                完整的体验报告已生成 <br />\r\n                请至前台扫描二维码获取\r\n              </div>\r\n              <div className=\"qrcode-image\">\r\n                <QRCode size={180} value={`${nickname}#${grade}`} />\r\n              </div>\r\n            </div>\r\n            <div className=\"re-experience\">\r\n              <Button\r\n                className=\"re-experience-btn\"\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  localStorage.setItem(\"grade\", \"\");\r\n                  setGrade(\"\");\r\n                }}\r\n              >\r\n                继续体验\r\n              </Button>\r\n              <Button\r\n                className=\"re-experience-btn\"\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  localStorage.setItem(\"grade\", \"\");\r\n                  localStorage.setItem(\r\n                    \"experiencedModules\",\r\n                    JSON.stringify([])\r\n                  );\r\n                  setGrade(\"\");\r\n                  setExperiencedModules([]);\r\n                }}\r\n              >\r\n                重新体验\r\n              </Button>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <div style={{ position: \"relative\", overflow: \"auto\" }}>\r\n              {moduleList.map((item) => {\r\n                const  isActive = experiencedModules.includes(item.key)\r\n                return (\r\n                  <div\r\n                    className={`module ${isActive ? \"active\" : \"\"}`}\r\n                    key={item.key}\r\n                    onClick={() => {\r\n                      window.wx.scanQRCode({\r\n                        needResult: 1,\r\n                        scanType: [\"qrCode\", \"barCode\"],\r\n                        success: function (res) {\r\n                          const resultStr = decodeURIComponent(res.resultStr);\r\n                          const k = getQueryVariable(\r\n                            \"moduleKey\",\r\n                            resultStr.split(\"?\")[2]\r\n                          );\r\n                          updateModules(k);\r\n                        },\r\n                      });\r\n                    }}\r\n                  >\r\n                    <div className=\"module-title\">\r\n                      <span  className={`${isActive ? \"active\" : \"\"}`}>{item.title}</span>\r\n                    </div>\r\n                    <div className=\"opration\">\r\n                      <img\r\n                        src={isActive ? starIcon : nostarIcon }\r\n                        className=\"status-icon\"\r\n                        alt=\"icon\"\r\n                      />\r\n                      <Button\r\n                        className={`status-btn ${isActive ? \"active\" : \"\"}`}\r\n                        size=\"small\"\r\n                      >\r\n                        {isActive? \" 已点亮\" : \"扫一扫点亮\"}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            <Button\r\n              className=\"submit-btn\"\r\n              onClick={() => {\r\n                setVisible(true);\r\n              }}\r\n            >\r\n              结束展馆体验\r\n            </Button>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      <ConfirmModal\r\n        visible={visible}\r\n        handleClose={() => {\r\n          setVisible(false);\r\n        }}\r\n        handleOk={handleOk}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","C:\\xiao\\work\\react\\experience-station\\src\\ConfirmModal.js",["33"],"import React from \"react\";\r\nimport { Button, Modal } from \"antd-mobile\";\r\nimport \"./App.css\";\r\n\r\nexport default ({ visible, handleClose, handleOk }) => {\r\n  return (\r\n    <Modal\r\n      className=\"c-modal\"\r\n      visible={visible}\r\n      transparent\r\n      maskClosable={false}\r\n      onClose={handleClose}\r\n      title=\"东莞厚街平安便民服务站\"\r\n      afterClose={() => {}}\r\n    >\r\n      <div className=\"modal-content\">\r\n        <div className=\"confirm-text\">确定生成体验报告？</div>\r\n        <div className=\"actions\">\r\n          <Button onClick={() => handleOk()}>确定</Button>\r\n          <Button onClick={() => handleClose()}>取消</Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n","C:\\xiao\\work\\react\\experience-station\\src\\service.js",[],"C:\\xiao\\work\\react\\experience-station\\src\\util.js",[],{"ruleId":"34","replacedBy":"35"},{"ruleId":"36","replacedBy":"37"},{"ruleId":"38","severity":1,"message":"39","line":37,"column":6,"nodeType":"40","endLine":37,"endColumn":12,"suggestions":"41"},{"ruleId":"38","severity":1,"message":"42","line":59,"column":6,"nodeType":"40","endLine":59,"endColumn":8,"suggestions":"43"},{"ruleId":"44","severity":1,"message":"45","line":5,"column":1,"nodeType":"46","endLine":25,"endColumn":3},"no-native-reassign",["47"],"no-negated-in-lhs",["48"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'nickname'. Either include it or remove the dependency array.","ArrayExpression",["49"],"React Hook useEffect has missing dependencies: 'currentKey' and 'updateModules'. Either include them or remove the dependency array.",["50"],"import/no-anonymous-default-export","Assign arrow function to a variable before exporting as module default","ExportDefaultDeclaration","no-global-assign","no-unsafe-negation",{"desc":"51","fix":"52"},{"desc":"53","fix":"54"},"Update the dependencies array to be: [code, nickname]",{"range":"55","text":"56"},"Update the dependencies array to be: [currentKey, updateModules]",{"range":"57","text":"58"},[1542,1548],"[code, nickname]",[2191,2193],"[currentKey, updateModules]"]