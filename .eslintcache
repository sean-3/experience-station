[{"C:\\xiao\\work\\react\\experience-station\\src\\index.js":"1","C:\\xiao\\work\\react\\experience-station\\src\\App.js":"2","C:\\xiao\\work\\react\\experience-station\\src\\reportWebVitals.js":"3","C:\\xiao\\work\\react\\experience-station\\src\\ConfirmModal.js":"4","C:\\xiao\\work\\react\\experience-station\\src\\util.js":"5","C:\\xiao\\work\\react\\experience-station\\src\\service.js":"6"},{"size":517,"mtime":1609774740983,"results":"7","hashOfConfig":"8"},{"size":6100,"mtime":1609783440221,"results":"9","hashOfConfig":"8"},{"size":375,"mtime":1609774740985,"results":"10","hashOfConfig":"8"},{"size":720,"mtime":1609774740967,"results":"11","hashOfConfig":"8"},{"size":972,"mtime":1609782069038,"results":"12","hashOfConfig":"8"},{"size":313,"mtime":1609778240439,"results":"13","hashOfConfig":"8"},{"filePath":"14","messages":"15","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"rxtbgd",{"filePath":"17","messages":"18","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"19","usedDeprecatedRules":"16"},{"filePath":"20","messages":"21","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"22","messages":"23","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"24","usedDeprecatedRules":"16"},{"filePath":"25","messages":"26","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"C:\\xiao\\work\\react\\experience-station\\src\\index.js",[],["29","30"],"C:\\xiao\\work\\react\\experience-station\\src\\App.js",["31","32"],"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"antd-mobile\";\r\nimport QRCode from \"qrcode.react\";\r\nimport ConfirmModal from \"./ConfirmModal\";\r\nimport starIcon from \"./assets/star.png\";\r\nimport nostarIcon from \"./assets/nostar.png\";\r\nimport logo from \"./assets/logo.png\";\r\nimport { moduleList, getQueryVariable, unique } from \"./util\";\r\nimport { getUseInfo, getSignature } from \"./service\";\r\nimport \"./App.css\";\r\n\r\nfunction App() {\r\n  const code = getQueryVariable(\"code\");\r\n\r\n  const [visible, setVisible] = useState(false);\r\n  const [grade, setGrade] = useState(localStorage.getItem(\"grade\"));\r\n  const [nickname, setNickname] = useState(\r\n    localStorage.getItem(\"nickname\") || \"\"\r\n  );\r\n\r\n  const [experiencedModules, setExperiencedModules] = useState(JSON.parse(localStorage.getItem(\"experiencedModules\")) || []);\r\n  \r\n  useEffect(() => {\r\n    if (!nickname) {\r\n      getUseInfo(code).then((res) => {\r\n        if (res.resultData) {\r\n          setNickname(res.resultData.nickname);\r\n          localStorage.setItem(\"nickname\", res.resultData.nickname);\r\n        }\r\n      });\r\n    }\r\n  }, [code]);\r\n\r\n  useEffect(() => {\r\n    getSignature(encodeURIComponent(window.location.href.split(\"#\")[0])).then(\r\n      (res) => {\r\n        if (res.resultStatus) {\r\n          const { appId, timestamp, nonceStr, signature } = res.resultData;\r\n          window.wx.config({\r\n            //debug: true,\r\n            appId: appId,\r\n            timestamp: timestamp.toString(), // 必填，生成签名的时间戳\r\n            nonceStr: nonceStr, // 必填，生成签名的随机串\r\n            signature: signature, // 必填，签名\r\n            jsApiList: [\"scanQRCode\"],\r\n          });\r\n        }\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  const updateModules = (k) =>{\r\n    const _experiencedModules = JSON.stringify(unique([...experiencedModules, k]));\r\n    localStorage.setItem(\"experiencedModules\", _experiencedModules);\r\n    setExperiencedModules(_experiencedModules)\r\n  }\r\n\r\n  useEffect(() => {\r\n    const currentKey = getQueryVariable(\"moduleKey\");\r\n    if(currentKey) updateModules(currentKey)\r\n  }, []);\r\n\r\n\r\n\r\n  const handleOk = () => {\r\n    let res = \"\";\r\n    if (experiencedModules.length > 10) {\r\n      res = \"优秀\";\r\n    } else if (experiencedModules.length > 8) {\r\n      res = \"良好\";\r\n    } else if (experiencedModules.length > 6) {\r\n      res = \"及格\";\r\n    } else {\r\n      res = \"不及格\";\r\n    }\r\n    setGrade(res);\r\n    localStorage.setItem(\"grade\", res);\r\n    setVisible(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <div className=\"App-footer\">东莞城市服务驿站</div>\r\n\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <div className=\"App-title\">\r\n          东莞市公安局\r\n          <br />\r\n          厚街分局\r\n        </div>\r\n        <div className=\"App-slogan\">\r\n          体育路警务工作站 <br />\r\n          欢迎您，{nickname}\r\n        </div>\r\n        <div className=\"App-tip\">注：点亮展项卡片，积分拿礼品</div>\r\n      </header>\r\n\r\n      <div className=\"content\">\r\n        {grade ? (\r\n          <div className=\"qrcode-container\">\r\n            <div className=\"qrcode-tip\">\r\n              完整的体验报告已生成 <br />\r\n              请至前台扫描二维码获取\r\n            </div>\r\n            <div className=\"qrcode-image\">\r\n              <QRCode size={200} value={`${nickname}#${grade}`} />\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            {moduleList.map((item) => {\r\n              return (\r\n                <div\r\n                  className=\"module\"\r\n                  key={item.key}\r\n                  onClick={() => {\r\n                    if (!experiencedModules.includes(item.key)) {\r\n                      window.wx.scanQRCode({\r\n                        // needResult: 1,\r\n                        scanType: [\"qrCode\", \"barCode\"],\r\n                        success: function (res) {\r\n                          // const resultStr = decodeURIComponent(res.resultStr);\r\n                          // const k= getQueryVariable('moduleKey', resultStr.split(\"?\")[2])\r\n                          // updateModules(k)\r\n                        },\r\n                      });\r\n                    }\r\n                  }}\r\n                >\r\n                  <div className=\"module-title\">\r\n                    <span>{item.title}</span>\r\n                  </div>\r\n                  <div className=\"opration\">\r\n                    <img\r\n                      src={\r\n                        experiencedModules.includes(item.key)\r\n                          ? starIcon\r\n                          : nostarIcon\r\n                      }\r\n                      className=\"status-icon\"\r\n                      alt=\"icon\"\r\n                    />\r\n                    <Button\r\n                      className={`status-btn ${\r\n                        experiencedModules.includes(item.key) ? \"active\" : \"\"\r\n                      }`}\r\n                      size=\"small\"\r\n                    >\r\n                      {experiencedModules.includes(item.key)\r\n                        ? \" 已点亮\"\r\n                        : \"扫一扫点亮\"}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n            <Button\r\n              className=\"submit-btn\"\r\n              onClick={() => {\r\n                setVisible(true);\r\n              }}\r\n            >\r\n              结束展馆体验\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <ConfirmModal\r\n        visible={visible}\r\n        handleClose={() => {\r\n          setVisible(false);\r\n        }}\r\n        handleOk={handleOk}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n\r\n// https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx6ac3baea53cef467&redirect_uri=https%3a%2f%2fcoding-pages-bucket-3413143-8194751-9772-444098-1301636502.cos-website.ap-guangzhou.myqcloud.com%3fmoduleKey%3d02&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect\r\n","C:\\xiao\\work\\react\\experience-station\\src\\reportWebVitals.js",[],"C:\\xiao\\work\\react\\experience-station\\src\\ConfirmModal.js",["33"],"import React from \"react\";\r\nimport { Button, Modal } from \"antd-mobile\";\r\nimport \"./App.css\";\r\n\r\nexport default ({ visible, handleClose, handleOk }) => {\r\n  return (\r\n    <Modal\r\n      className=\"c-modal\"\r\n      visible={visible}\r\n      transparent\r\n      maskClosable={false}\r\n      onClose={handleClose}\r\n      title=\"东莞厚街平安便民服务站\"\r\n      afterClose={() => {}}\r\n    >\r\n      <div className=\"modal-content\">\r\n        <div className=\"confirm-text\">确定生成体验报告？</div>\r\n        <div className=\"actions\">\r\n          <Button onClick={() => handleOk()}>确定</Button>\r\n          <Button onClick={() => handleClose()}>取消</Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n","C:\\xiao\\work\\react\\experience-station\\src\\util.js",[],"C:\\xiao\\work\\react\\experience-station\\src\\service.js",[],{"ruleId":"34","replacedBy":"35"},{"ruleId":"36","replacedBy":"37"},{"ruleId":"38","severity":1,"message":"39","line":32,"column":6,"nodeType":"40","endLine":32,"endColumn":12,"suggestions":"41"},{"ruleId":"38","severity":1,"message":"42","line":61,"column":6,"nodeType":"40","endLine":61,"endColumn":8,"suggestions":"43"},{"ruleId":"44","severity":1,"message":"45","line":5,"column":1,"nodeType":"46","endLine":25,"endColumn":3},"no-native-reassign",["47"],"no-negated-in-lhs",["48"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'nickname'. Either include it or remove the dependency array.","ArrayExpression",["49"],"React Hook useEffect has a missing dependency: 'updateModules'. Either include it or remove the dependency array.",["50"],"import/no-anonymous-default-export","Assign arrow function to a variable before exporting as module default","ExportDefaultDeclaration","no-global-assign","no-unsafe-negation",{"desc":"51","fix":"52"},{"desc":"53","fix":"54"},"Update the dependencies array to be: [code, nickname]",{"range":"55","text":"56"},"Update the dependencies array to be: [updateModules]",{"range":"57","text":"58"},[1120,1126],"[code, nickname]",[2065,2067],"[updateModules]"]